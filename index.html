<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë§ˆìŒ ì •ì› ğŸŒ±</title>
    <!-- 1. ë””ìì¸ ë„êµ¬ (Tailwind CSS) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. ë¦¬ì•¡íŠ¸ ì–¸ì–´ ë²ˆì—­ê¸° (Babel) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 3. ì• ë‹ˆë©”ì´ì…˜ ë° í°íŠ¸ -->
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        * { font-family: "Pretendard", sans-serif; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        .animate-bounce-in { animation: bounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounceIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        
        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° (ê¹”ë”í•œ ë””ìì¸) */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { Heart, Wind, BookOpen, Phone, AlertCircle, User, LogOut, Send, Mic, Play, Pause, X, Wifi, WifiOff, Lock, Trash2, BarChart2, CheckCircle2, Loader2, Youtube, Music, ExternalLink } from 'https://esm.sh/lucide-react@0.263.1?deps=react@18.2.0';
        
        // íŒŒì´ì–´ë² ì´ìŠ¤ ë„êµ¬
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, deleteDoc, doc, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // --- â­ ì„ ìƒë‹˜ì˜ LOVE í”„ë¡œì íŠ¸ ë¹„ë°€ ì—´ì‡  ---
        const firebaseConfig = {
            apiKey: "AIzaSyATOUHaxLyQpKSnh3tSTKbE545Z3hrpd00",
            authDomain: "love-c5ddb.firebaseapp.com",
            projectId: "love-c5ddb",
            storageBucket: "love-c5ddb.firebasestorage.app",
            messagingSenderId: "333805011394",
            appId: "1:333805011394:web:50dcb1c7544ed07f23d65b"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'mind-garden-class-6-2';

        // --- ë°ì´í„° ì •ì˜ ---
        const MOOD_COLORS = [
            { id: 'joy', color: 'bg-yellow-300', text: 'ê¸°ì¨', message: 'í–‡ì‚´ì²˜ëŸ¼ ë°˜ì§ì´ëŠ”êµ¬ë‚˜!' },
            { id: 'excited', color: 'bg-orange-300', text: 'ì‹ ë‚¨', message: 'ì—ë„ˆì§€ê°€ ë„˜ì¹˜ëŠ”êµ¬ë‚˜!' },
            { id: 'calm', color: 'bg-green-300', text: 'í‰ì˜¨', message: 'ë‚˜ë¬´ì²˜ëŸ¼ í¸ì•ˆí•˜ë„¤.' },
            { id: 'focus', color: 'bg-teal-300', text: 'ì§‘ì¤‘', message: 'ë©‹ì§€ê²Œ ëª°ì…í•˜ê³  ìˆêµ¬ë‚˜.' },
            { id: 'love', color: 'bg-pink-300', text: 'ì‚¬ë‘', message: 'ë§ˆìŒì´ ë”°ëœ»í•´ì§€ëŠ”êµ¬ë‚˜.' },
            { id: 'sad', color: 'bg-blue-300', text: 'ìŠ¬í””', message: 'ë¹„ê°€ ì˜¤ëŠ”êµ¬ë‚˜. ê´œì°®ì•„.' },
            { id: 'lonely', color: 'bg-indigo-300', text: 'ì™¸ë¡œì›€', message: 'ì„ ìƒë‹˜ì´ ê³ì— ìˆì–´.' },
            { id: 'angry', color: 'bg-red-400', text: 'í™”ë‚¨', message: 'ì ì‹œ ì‹¬í˜¸í¡ í•´ë³¼ê¹Œ?' },
            { id: 'anxious', color: 'bg-purple-300', text: 'ë¶ˆì•ˆ', message: 'ì•ˆê°œ ì† ê°™êµ¬ë‚˜. ì† ì¡ì•„ì¤„ê²Œ.' },
            { id: 'gloomy', color: 'bg-gray-800 text-white', text: 'ë§‰ë§‰í•¨', message: 'ìº„ìº„í•œ ë°¤ ê°™êµ¬ë‚˜. ë³„ì´ ëœ° ê±°ì•¼.' },
        ];

        // --- â­ ìœ íŠœë¸Œ ì˜ìƒ ëª©ë¡ ---
        const MEDITATION_VIDEOS = [
            { id: '6hU62ZFuMX4', title: 'ë§ˆìŒ ê±´ê°• ë‹¤ì‹œë³´ê¸°', category: 'ë§ˆìŒì±™ê¹€' },
            { id: 'Cnfj6QCGLyA', title: 'í¸ì•ˆí•œ í”¼ì•„ë…¸', category: 'ìŒì•…' },
            { id: 'pMhRLWII7p8', title: 'ë§¤ì¼ ì™¸ì¹˜ëŠ” ê¸ì • í™•ì–¸', category: 'ìì¡´ê°' }
        ];

        // --- ë©”ì¸ ì»´í¬ë„ŒíŠ¸ ---
        function MindGardenApp() {
            const [user, setUser] = useState(null);
            const [userType, setUserType] = useState(null); 
            const [moodLogs, setMoodLogs] = useState([]);
            const [journals, setJournals] = useState([]);
            const [sosActive, setSosActive] = useState(false);
            const [isOnline, setIsOnline] = useState(false);
            const [passwordInput, setPasswordInput] = useState('');
            const [showPassword, setShowPassword] = useState(false);

            useEffect(() => {
                signInAnonymously(auth).catch(console.error);
                return onAuthStateChanged(auth, (u) => {
                    setUser(u);
                    setIsOnline(!!u);
                });
            }, []);

            useEffect(() => {
                if (!user) return;
                
                const moodUnsub = onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'mood_logs'), (sn) => {
                    const logs = sn.docs.map(d => ({id: d.id, ...d.data()})).sort((a,b) => (b.timestamp?.seconds||0)-(a.timestamp?.seconds||0));
                    setMoodLogs(logs);
                });

                const journalUnsub = onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'journals'), (sn) => {
                    const logs = sn.docs.map(d => ({id: d.id, ...d.data()})).sort((a,b) => (b.timestamp?.seconds||0)-(a.timestamp?.seconds||0));
                    setJournals(logs);
                });

                return () => { moodUnsub(); journalUnsub(); };
            }, [user]);

            const handleTeacherLogin = () => {
                if (passwordInput === '0607') { 
                    setUserType('teacher');
                    setShowPassword(false);
                    setPasswordInput('');
                } else {
                    alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
                }
            };

            if (!userType) {
                if (showPassword) {
                    return (
                        <div className="flex flex-col items-center justify-center min-h-screen bg-blue-50 p-6">
                            <div className="bg-white p-8 rounded-3xl shadow-xl max-w-sm w-full text-center space-y-6 animate-fade-in">
                                <div className="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto text-blue-600">
                                    <Lock size={32} />
                                </div>
                                <h2 className="text-xl font-bold text-gray-800">ì„ ìƒë‹˜ í™•ì¸</h2>
                                <input 
                                    type="password" 
                                    value={passwordInput}
                                    onChange={(e) => setPasswordInput(e.target.value)}
                                    placeholder="ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬"
                                    className="w-full p-4 bg-gray-50 rounded-xl border border-gray-200 text-center text-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                                />
                                <div className="flex gap-2">
                                    <button onClick={() => setShowPassword(false)} className="flex-1 py-3 text-gray-500 font-bold bg-gray-100 rounded-xl">ì·¨ì†Œ</button>
                                    <button onClick={handleTeacherLogin} className="flex-1 py-3 text-white font-bold bg-blue-500 rounded-xl">í™•ì¸</button>
                                </div>
                            </div>
                        </div>
                    );
                }

                return (
                    <div className="flex flex-col items-center justify-center min-h-screen bg-pink-50 p-6">
                        <div className="bg-white p-8 rounded-3xl shadow-xl max-w-sm w-full text-center space-y-8 animate-fade-in">
                            <div className="space-y-2">
                                <h1 className="text-3xl font-bold text-gray-800">ğŸŒ± ë§ˆìŒ ì •ì›</h1>
                                <p className="text-gray-500">ë„ˆì™€ ë‚˜, ìš°ë¦¬ê°€ ì—°ê²°ë˜ëŠ” ê³³</p>
                            </div>
                            <div className="space-y-4">
                                <button onClick={() => setUserType('student')} className="w-full py-4 bg-emerald-100 text-emerald-800 rounded-2xl font-bold flex justify-center gap-2 hover:scale-105 transition-transform shadow-sm">
                                    <User size={24} /> í•™ìƒ ì…ì¥í•˜ê¸°
                                </button>
                                <button onClick={() => setShowPassword(true)} className="w-full py-4 bg-blue-100 text-blue-800 rounded-2xl font-bold flex justify-center gap-2 hover:scale-105 transition-transform shadow-sm">
                                    <BookOpen size={24} /> ì„ ìƒë‹˜ ì…ì¥
                                </button>
                            </div>
                            <div className="text-xs text-gray-400 mt-4">
                                {isOnline ? <span className="text-emerald-500 flex justify-center items-center gap-1"><Wifi size={12}/> ì„œë²„ ì—°ê²°ë¨</span> : "ì—°ê²° ì¤‘..."}
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen w-full flex justify-center bg-gray-100 py-0 sm:py-8">
                    <div className="w-full max-w-md bg-white min-h-screen sm:min-h-[800px] shadow-2xl relative flex flex-col sm:rounded-3xl overflow-hidden">
                        {userType === 'student' 
                            ? <StudentView moodLogs={moodLogs} setSosActive={setSosActive} sosActive={sosActive} onLogout={() => setUserType(null)} db={db} appId={appId} />
                            : <TeacherView moodLogs={moodLogs} journals={journals} onLogout={() => setUserType(null)} db={db} appId={appId} />
                        }
                    </div>
                </div>
            );
        }

        // --- í•™ìƒ í™”ë©´ ---
        function StudentView({ moodLogs, setSosActive, sosActive, onLogout, db, appId }) {
            const [activeTab, setActiveTab] = useState('home');
            const [latestMessage, setLatestMessage] = useState(null);
            const [isCoolingDown, setIsCoolingDown] = useState(false);
            const [selectedMood, setSelectedMood] = useState(null);

            useEffect(() => {
                const q = collection(db, 'artifacts', appId, 'public', 'data', 'messages');
                return onSnapshot(q, (sn) => {
                    const msgs = sn.docs.map(d => d.data()).sort((a,b) => (b.timestamp?.seconds||0)-(a.timestamp?.seconds||0));
                    if(msgs.length > 0) setLatestMessage(msgs[0]);
                });
            }, []);

            const handleMood = async (mood) => {
                if (isCoolingDown) return; 
                
                setIsCoolingDown(true);
                setSelectedMood(mood);
                
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'mood_logs'), {
                    mood: mood.id, date: new Date().toLocaleDateString(), timestamp: serverTimestamp(), studentName: 'ì§€ì€'
                });

                setTimeout(() => {
                    setIsCoolingDown(false);
                    setSelectedMood(null);
                }, 5000);
            };

            return (
                <div className="flex-1 flex flex-col relative bg-amber-50/30 h-full overflow-hidden">
                    <header className="p-6 pt-8 flex justify-between bg-white shadow-sm rounded-b-3xl z-10 flex-shrink-0">
                        <div><h2 className="text-2xl font-bold text-gray-800">ì•ˆë…•, ì§€ì€ì•„! ğŸ‘‹</h2><p className="text-sm text-gray-500">ì˜¤ëŠ˜ë„ ì†Œì¤‘í•œ í•˜ë£¨ì•¼</p></div>
                        <button onClick={onLogout}><LogOut className="text-gray-400" /></button>
                    </header>

                    <main className="flex-1 overflow-y-auto p-6 pb-28 space-y-6 no-scrollbar">
                        <button onClick={() => setSosActive(true)} className="w-full bg-red-100 text-red-600 p-4 rounded-2xl font-bold flex justify-center gap-2 animate-pulse shadow-sm">
                            <AlertCircle /> ì§€ê¸ˆ ë§ˆìŒì´ ë„ˆë¬´ í˜ë“¤ì–´ìš” (SOS)
                        </button>

                        {activeTab === 'home' && (
                            <div className="space-y-6 animate-fade-in">
                                <div className="bg-white p-6 rounded-3xl shadow-sm border border-gray-100">
                                    <h3 className="font-bold text-gray-700 mb-4">ì˜¤ëŠ˜ ë§ˆìŒ ìƒ‰ê¹”ì€?</h3>
                                    
                                    {isCoolingDown && selectedMood ? (
                                        <div className={`p-6 rounded-2xl ${selectedMood.color} text-center space-y-2 animate-fade-in`}>
                                            <div className="text-3xl">âœ¨</div>
                                            <p className="font-bold text-lg">{selectedMood.text}</p>
                                            <p className="text-sm opacity-90">{selectedMood.message}</p>
                                            <p className="text-xs mt-3 bg-white/30 inline-block px-3 py-1 rounded-full">ì ì‹œ í›„ì— ë‹¤ì‹œ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”...</p>
                                        </div>
                                    ) : (
                                        <div className="grid grid-cols-5 gap-3">
                                            {MOOD_COLORS.map(m => (
                                                <button 
                                                    key={m.id} 
                                                    onClick={() => handleMood(m)} 
                                                    className={`h-12 w-full rounded-xl ${m.color} hover:scale-110 transition-transform shadow-sm`} 
                                                    title={m.text}
                                                />
                                            ))}
                                        </div>
                                    )}
                                </div>
                                <div className="bg-blue-50 p-6 rounded-3xl shadow-sm border border-blue-100 relative overflow-hidden">
                                    <h3 className="text-blue-800 font-bold mb-2 flex items-center gap-2"><Heart size={16} fill="currentColor"/> ì„ ìƒë‹˜ì˜ ì‘ì›</h3>
                                    <p className="text-blue-900 font-medium">"{latestMessage ? latestMessage.text : "ì§€ì€ì•„, í˜ë“¤ë©´ ì–¸ì œë“  ë¹ˆ ì˜ìì— í„¸ì–´ë†“ìœ¼ë ´. ì„ ìƒë‹˜ì€ ëŠ˜ ë„¤ í¸ì´ì•¼."}"</p>
                                </div>
                            </div>
                        )}
                        {activeTab === 'meditation' && <MeditationPlayer />}
                        {activeTab === 'journal' && <JournalEditor db={db} appId={appId} />}
                    </main>

                    {sosActive && (
                        <div className="absolute inset-0 bg-black/60 z-50 flex items-center justify-center p-6 backdrop-blur-sm animate-fade-in">
                            <div className="bg-white w-full rounded-3xl p-8 text-center relative animate-bounce-in">
                                <button onClick={() => setSosActive(false)} className="absolute top-4 right-4 p-2 text-gray-400"><X /></button>
                                <div className="w-16 h-16 bg-red-100 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4"><Phone size={32}/></div>
                                <h3 className="text-2xl font-bold mb-2">í˜¼ìê°€ ì•„ë‹ˆì•¼</h3>
                                <div className="space-y-3 mt-6">
                                    <button className="w-full py-4 bg-pink-500 text-white rounded-xl font-bold shadow-lg">ì—„ë§ˆì—ê²Œ ì „í™”í•˜ê¸°</button>
                                    <button className="w-full py-4 bg-gray-200 text-gray-700 rounded-xl font-bold">ìƒë‹´ì„¼í„° (1388)</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <nav className="absolute bottom-0 w-full bg-white border-t border-gray-100 flex justify-around p-4 pb-8 rounded-t-3xl shadow-[0_-5px_15px_rgba(0,0,0,0.05)]">
                        <NavButton active={activeTab==='home'} onClick={()=>setActiveTab('home')} icon={<Heart/>} label="í™ˆ" />
                        <NavButton active={activeTab==='meditation'} onClick={()=>setActiveTab('meditation')} icon={<Wind/>} label="ëª…ìƒ" />
                        <NavButton active={activeTab==='journal'} onClick={()=>setActiveTab('journal')} icon={<BookOpen/>} label="ì¼ê¸°" />
                    </nav>
                </div>
            );
        }

        // --- ì„ ìƒë‹˜ í™”ë©´ ---
        function TeacherView({ moodLogs, journals, onLogout, db, appId }) {
            const [msg, setMsg] = useState('');
            const [isDeleting, setIsDeleting] = useState(false);
            const dangerCount = moodLogs.filter(l => l.mood === 'sad' || l.mood === 'angry' || l.mood === 'lonely' || l.mood === 'gloomy').length;

            const moodCounts = MOOD_COLORS.reduce((acc, cur) => {
                acc[cur.id] = moodLogs.filter(l => l.mood === cur.id).length;
                return acc;
            }, {});
            const totalLogs = moodLogs.length || 1; 

            const sendMsg = async () => {
                if(!msg.trim()) return;
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'messages'), {
                    text: msg, timestamp: serverTimestamp(), sender: 'teacher'
                });
                alert("ì „ì†¡ ì™„ë£Œ!"); setMsg('');
            };

            const resetData = async () => {
                if(!confirm("âš ï¸ ê²½ê³ : ëª¨ë“  ê°ì • ê¸°ë¡ê³¼ ì¼ê¸°ê°€ ì‚­ì œë©ë‹ˆë‹¤.\ní™”ë©´ì—ì„œë„ ì¦‰ì‹œ ì‚¬ë¼ì§‘ë‹ˆë‹¤.")) return;
                
                setIsDeleting(true);
                try {
                    const deleteCollection = async (collName) => {
                        const q = collection(db, 'artifacts', appId, 'public', 'data', collName);
                        const sn = await getDocs(q);
                        const deletePromises = sn.docs.map(d => deleteDoc(d.ref));
                        await Promise.all(deletePromises);
                    };

                    await deleteCollection('mood_logs');
                    await deleteCollection('journals');
                    alert("ëª¨ë“  ê¸°ë¡ì´ ê¹¨ë—í•˜ê²Œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
                } catch (e) {
                    console.error(e);
                    alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: " + e.message);
                } finally {
                    setIsDeleting(false);
                }
            };

            return (
                <div className="flex-1 flex flex-col bg-slate-50 h-full overflow-hidden">
                    <header className="p-6 pt-8 bg-white shadow-sm flex justify-between flex-shrink-0">
                        <div><h2 className="text-xl font-bold">ğŸ‘©â€ğŸ« í•™ìƒ ì¼€ì–´ ëŒ€ì‹œë³´ë“œ</h2><p className="text-sm text-slate-500">ê¹€ì§€ì€ í•™ìƒ (ì‹¤ì‹œê°„)</p></div>
                        <button onClick={onLogout}><LogOut className="text-gray-400"/></button>
                    </header>
                    
                    <main className="p-6 space-y-6 flex-1 overflow-y-auto no-scrollbar pb-20">
                        {/* ìƒíƒœ ìš”ì•½ */}
                        <div className="grid grid-cols-2 gap-4">
                            <div className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
                                <h4 className="text-xs font-bold text-slate-400 mb-2">ìµœê·¼ ê°ì • íë¦„</h4>
                                <div className="flex items-end h-12 gap-1">
                                    {moodLogs.slice(0,7).map((l,i) => (
                                        <div key={i} className={`flex-1 rounded-t-lg h-full opacity-80 ${MOOD_COLORS.find(c=>c.id===l.mood)?.color || 'bg-gray-200'}`} title={l.date}></div>
                                    ))}
                                    {moodLogs.length === 0 && <span className="text-xs text-gray-300 mx-auto self-center">ê¸°ë¡ ì—†ìŒ</span>}
                                </div>
                            </div>
                            <div className={`p-4 rounded-2xl border ${dangerCount>0 ? 'bg-red-50 border-red-200' : 'bg-emerald-50 border-emerald-200'}`}>
                                <h4 className="text-xs font-bold mb-2">ê´€ì‹¬ í•„ìš” ì§€ìˆ˜</h4>
                                <div className="flex items-center gap-2 text-2xl font-bold">
                                    <AlertCircle className={dangerCount>0?'text-red-500':'text-emerald-500'} />
                                    <span className={dangerCount>0?'text-red-600':'text-emerald-600'}>{dangerCount>0?'ì£¼ì˜':'ì•ˆì •'}</span>
                                </div>
                            </div>
                        </div>

                        {/* í†µê³„ ê·¸ë˜í”„ */}
                        <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                            <h3 className="font-bold text-slate-700 mb-4 flex items-center gap-2"><BarChart2 size={18}/> ê°ì • í†µê³„ (ì´ {moodLogs.length}ê±´)</h3>
                            <div className="space-y-3">
                                {MOOD_COLORS.map(color => {
                                    const count = moodCounts[color.id] || 0;
                                    const percentage = Math.round((count / totalLogs) * 100);
                                    if (count === 0) return null; 

                                    return (
                                        <div key={color.id} className="flex items-center gap-3">
                                            <div className="w-12 text-xs font-bold text-gray-600">{color.text}</div>
                                            <div className="flex-1 h-3 bg-gray-100 rounded-full overflow-hidden">
                                                <div 
                                                    style={{width: `${percentage}%`}} 
                                                    className={`h-full rounded-full ${color.color.split(' ')[0]} transition-all duration-500`}
                                                ></div>
                                            </div>
                                            <div className="w-8 text-xs text-right text-gray-400">{count}ê±´</div>
                                        </div>
                                    )
                                })}
                                {moodLogs.length === 0 && <div className="text-center text-sm text-gray-300 py-4">ì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>}
                            </div>
                        </div>

                        {/* ê²©ë ¤ ë©”ì‹œì§€ */}
                        <div className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
                            <h3 className="font-bold mb-3">ğŸ’Œ ê²©ë ¤ ë©”ì‹œì§€</h3>
                            <textarea value={msg} onChange={e=>setMsg(e.target.value)} className="w-full bg-slate-50 rounded-xl p-3 text-sm resize-none mb-2 focus:outline-blue-200" rows="3" placeholder="ì§€ì€ì´ì—ê²Œ ë³´ë‚¼ ì‘ì›..."></textarea>
                            <button onClick={sendMsg} className="w-full bg-blue-500 text-white py-3 rounded-xl font-bold flex justify-center gap-2 hover:bg-blue-600 transition-colors"><Send size={18}/> ì „ì†¡</button>
                        </div>

                        {/* ë°ì´í„° ì´ˆê¸°í™” ë²„íŠ¼ */}
                        <div className="pt-4 border-t border-gray-200">
                            <button 
                                onClick={resetData} 
                                disabled={isDeleting}
                                className={`w-full py-3 text-sm font-bold border rounded-xl flex justify-center items-center gap-2 transition-all
                                    ${isDeleting 
                                        ? 'bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed' 
                                        : 'bg-white text-red-400 border-red-100 hover:bg-red-50'}`}
                            >
                                {isDeleting ? <Loader2 size={16} className="animate-spin"/> : <Trash2 size={16}/>}
                                {isDeleting ? 'ëª¨ë“  ê¸°ë¡ ì‚­ì œ ì¤‘...' : 'ëª¨ë“  ê¸°ë¡ ì´ˆê¸°í™” (Reset)'}
                            </button>
                        </div>
                    </main>
                </div>
            );
        }

        // --- ê¸°íƒ€ ì»´í¬ë„ŒíŠ¸ (ì—…ë°ì´íŠ¸ë¨: ìœ íŠœë¸Œ ê¸°ëŠ¥ ì¶”ê°€) ---
        function MeditationPlayer() {
            const [play, setPlay] = useState(false);
            const [time, setTime] = useState(180);
            
            useEffect(() => {
                let i; 
                if(play && time > 0) i = setInterval(() => setTime(t => t-1), 1000);
                return () => clearInterval(i);
            }, [play, time]);

            return (
                <div className="h-full flex flex-col space-y-6 overflow-y-auto no-scrollbar pb-10">
                    {/* 1. ê¸°ì¡´ ë‡Œí˜¸í¡ íƒ€ì´ë¨¸ */}
                    <div className="bg-white rounded-3xl p-6 shadow-sm border border-gray-100 flex flex-col items-center space-y-6">
                        <div className="text-center">
                            <h3 className="text-lg font-bold flex items-center justify-center gap-2"><Wind size={20} className="text-emerald-500"/> ë‡Œí˜¸í¡ ëª…ìƒ</h3>
                            <p className="text-xs text-gray-400 mt-1">í˜¸í¡ì—ë§Œ ì§‘ì¤‘í•´ë´ìš”</p>
                        </div>
                        <div className={`w-40 h-40 rounded-full bg-emerald-50 flex items-center justify-center transition-all duration-[4000ms] ${play?'scale-110 shadow-[0_0_30px_rgba(16,185,129,0.2)]':''}`}>
                            <div className="text-3xl font-bold text-emerald-600 tracking-widest">{Math.floor(time/60)}:{(time%60).toString().padStart(2,'0')}</div>
                        </div>
                        <button onClick={() => setPlay(!play)} className={`px-8 py-3 rounded-full font-bold shadow-md transition-colors flex items-center gap-2 ${play?'bg-gray-100 text-gray-500':'bg-emerald-500 text-white'}`}>
                            {play ? <><Pause size={18}/> ë©ˆì¶¤</> : <><Play size={18}/> ì‹œì‘</>}
                        </button>
                    </div>

                    {/* 2. ìœ íŠœë¸Œ ë§í¬ ëª©ë¡ */}
                    <div className="space-y-4">
                        <h3 className="font-bold text-gray-700 px-2 flex items-center gap-2"><Youtube size={20} className="text-red-500"/> íë§ ì˜ìƒ ëª¨ìŒ (ìœ íŠœë¸Œ ì´ë™)</h3>

                        <div className="grid grid-cols-1 gap-3">
                            {MEDITATION_VIDEOS.map((video) => (
                                <a 
                                    key={video.id}
                                    href={`https://www.youtube.com/watch?v=${video.id}`}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="p-4 rounded-2xl text-left transition-all flex items-center gap-3 border bg-white border-gray-100 hover:bg-red-50 hover:border-red-100 group"
                                >
                                    <div className="w-10 h-10 rounded-full bg-red-100 text-red-500 flex items-center justify-center group-hover:bg-red-500 group-hover:text-white transition-colors">
                                        <Play size={16} fill="currentColor"/>
                                    </div>
                                    <div className="flex-1">
                                        <div className="text-sm font-bold text-gray-800 group-hover:text-red-600 transition-colors">{video.title}</div>
                                        <div className="text-xs text-gray-400">#{video.category}</div>
                                    </div>
                                    <div className="text-gray-300 group-hover:text-red-300">
                                        <ExternalLink size={16} />
                                    </div>
                                </a>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        function JournalEditor({ db, appId }) {
            const [mode, setMode] = useState('gratitude');
            const [txt, setTxt] = useState('');
            const save = async () => {
                if(!txt.trim()) return;
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'journals'), {
                    type: mode, text: txt, date: new Date().toLocaleDateString(), timestamp: serverTimestamp()
                });
                alert("ì €ì¥ë˜ì—ˆì–´ìš”! ğŸŒ¸"); setTxt('');
            };
            return (
                <div className="h-full flex flex-col space-y-4">
                    <div className="flex bg-white p-1 rounded-2xl border">
                        <button onClick={()=>setMode('gratitude')} className={`flex-1 py-2 rounded-xl font-bold text-sm ${mode==='gratitude'?'bg-yellow-100 text-yellow-700':'text-gray-400'}`}>ğŸ™ ê°ì‚¬ ì¼ê¸°</button>
                        <button onClick={()=>setMode('emptyChair')} className={`flex-1 py-2 rounded-xl font-bold text-sm ${mode==='emptyChair'?'bg-purple-100 text-purple-700':'text-gray-400'}`}>ğŸª‘ ì†ë§ˆìŒ ì˜ì</button>
                    </div>
                    <div className="flex-1 bg-white rounded-3xl p-6 border border-gray-100 flex flex-col">
                        <textarea value={txt} onChange={e=>setTxt(e.target.value)} className="flex-1 resize-none focus:outline-none" placeholder={mode==='gratitude'?"ì˜¤ëŠ˜ ê³ ë§ˆì› ë˜ ì¼ì€?":"ëˆ„êµ¬ì—ê²Œë„ ëª»í•œ ë§..."}></textarea>
                        <div className="flex justify-end pt-4"><button onClick={save} className="bg-yellow-400 text-white px-6 py-2 rounded-full font-bold shadow-md">ì €ì¥</button></div>
                    </div>
                </div>
            );
        }

        function NavButton({ active, onClick, icon, label }) {
            return <button onClick={onClick} className={`flex flex-col items-center gap-1 ${active?'text-gray-800':'text-gray-300'}`}><div className={active?'bg-yellow-300 p-2 rounded-2xl shadow-md':'p-2'}>{icon}</div><span className="text-[10px] font-bold">{label}</span></button>;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MindGardenApp />);
    </script>
</body>
</html>
